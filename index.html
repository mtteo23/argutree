<html lang="en">
	<head>
		
		<link rel="stylesheet" href="style.css">
		
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Argument Tree</title>
	</head>

	<body>
		<div id="graph" align="center">
		</div>
	</body>
	
	<!-- Embed the code.txt content directly in the HTML -->
    <script id="argument-data" type="text/plain">
0{Mozione}{Definizioni e contestualizzazione}
1-0{Assertion 1}{Reasoning 1}
2-0{Assertion 2}{Reasoning 2}
3-0{Assertion 3}{Reasoning 3}
1-1-0{SubAssertion}{Reasoning 4}
    </script>
    
    <script id="evidence-data" type="text/plain">
    </script>
    
    <script id="comment-data" type="text/plain">
    </script>

	<script>
		
		 document.addEventListener('DOMContentLoaded', () => {
			parent=document.getElementById("graph");
			
			showArg('0', parent);
			expandArg('0');
        });
		
		function showArg(id, parent)
		{
			//Main div
			const main=document.createElement('div');
			main.id=id;
			main.classList.add("Arg");
			parent.appendChild(main);
			
			if(id!='0')
			{			
				const upline=document.createElement('div');
				upline.classList.add("vertical-line");
				main.appendChild(upline);		
			}
			//trunk div
			const trunk=document.createElement('div');
			trunk.id='T-'+id;
			trunk.classList.add("Trunk");
			trunk.align='center';
			trunk.onclick=function() { expandArg(trunk.id.slice(2)) };
			main.appendChild(trunk);
			
			//Assertion
			const ass=document.createElement('p');
			ass.id='A-'+id;
			ass.classList.add("Assertion");
			ass.textContent=primaryText(id);
			trunk.appendChild(ass);
			
			//Secondary elements container
			const expanded=document.createElement('div');
			expanded.id='EXP-'+id;
			expanded.classList.add("Expanded");
			trunk.appendChild(expanded);
			
			//Reasoning
			const res=document.createElement('p');
			res.id='R-'+id;
			res.classList.add("Reasoning");
			res.textContent=secondaryText(id);
			expanded.appendChild(res);
			
			//Evidence List
			const el=document.createElement('ul');
			el.id='EL-'+id;
			el.classList.add("EvidenceList");
			el.align='center';
			expanded.appendChild(el);
			
			IDs=evList();
			for(let i=0; i<IDs.length; i++)
			{
				if(isEvidenceOf(id, IDs[i]))
				{
					const ev=document.createElement('p');
					ev.id=IDs[i];
					ev.classList.add("Evidence");
					ev.textContent=primaryTextEvidence(IDs[i]);
					el.appendChild(ev);
				}
			}
			
			//Button Div
			const but=document.createElement('div');
			but.id='B-'+id;
			but.classList.add("BtnDiv");
			expanded.appendChild(but);
				
			//Add Button Evidence
			const addE=document.createElement('p');
			addE.id='AddE-'+id;
			addE.classList.add("AddBtnEvidence");
			addE.textContent="+";
			addE.onclick=function() { createEvidence(addE.id.slice(5)) };
			but.appendChild(addE);
			
			//More Options Button
			const opt=document.createElement('p');
			opt.id='OPT-'+id;
			opt.classList.add("OptBtn");
			opt.textContent="...";
			opt.onclick=function() { expandOption(opt.id.slice(4)) };
			but.appendChild(opt);
			
			const lowline=document.createElement('div');
			lowline.classList.add("vertical-line");
			main.appendChild(lowline);
			
			
			
			{
				IDs=idList();
				for(let i=0; i<IDs.length; i++)
				{
					if(isParentOf(id, IDs[i]))
					{
						const hline=document.createElement('div');
						hline.classList.add("horizontal-line");
						main.appendChild(hline);
						break;
					}
				}
			}
			
			//SubArgument List
			const sal=document.createElement('ul');
			sal.id='SAL-'+id;
			sal.classList.add("SubArgList");
			main.appendChild(sal);
			
			IDs=idList();
			for(let i=0; i<IDs.length; i++)
			{
				if(isParentOf(id, IDs[i]))
				{
					showArg(IDs[i], sal);
				}
			}
			const addBtnDiv=document.createElement('div');
			sal.appendChild(addBtnDiv);
			
			const butupline=document.createElement('div');
			butupline.classList.add("vertical-line");
			addBtnDiv.appendChild(butupline);
			
			//Add Button Argument
			const addA=document.createElement('p');
			addA.id='AddA-'+id;
			addA.classList.add("AddBtnArg");
			addA.textContent="+";
			addA.onclick=function() { createArg(addA.id.slice(5)) };
			addBtnDiv.appendChild(addA);
		}
		
		function expandArg(id)
		{
			IDs=idList();
			for(let i=0; i<IDs.length; i++)
			{
				val=""
				if(IDs[i]==id)
					val="block";
				else
					val="none";
				
				document.getElementById('EXP-'+IDs[i]).style.display=val;
			}
		}
		
		function createArg(parent)
		{
			let lastN=0;
			let found=1;
			IDs=idList();
			while(found==1)
			{
				found=0;
				lastN++;
				for(i=0; i<IDs.length; i++)
				{
					if(lastN+'-'+parent==IDs[i])
						found=1;
				}
			}
			
			id=lastN+'-'+parent;
			
			const p=document.getElementById('AddA-'+parent);
			
			const AI=document.createElement('input');
			AI.id='AI-'+id;
			AI.classList.add("AssertionInput");
			AI.textContent='';
			
			AI.addEventListener('keyup', function onEvent(e) {
				if (event.key === "Enter") {
					appArg(AI.id.slice(3), AI.value, 'Write here the reasoning');
					
					const graph=document.getElementById("graph");
					graph.innerHTML = "";
					showArg('0', graph);
					expandArg(AI.id.slice(3));
				}
			});
			
			p.replaceWith(AI);
		}
		
		function createEvidence(parent)
		{
			let lastN=0;
			let found=1;
			IDs=evList();
			while(found==1)
			{
				found=0;
				lastN++;
				for(i=0; i<IDs.length; i++)
				{
					if(lastN+'E-'+parent==IDs[i])
						found=1;
				}
			}
			
			id=lastN+'E-'+parent;
			
			const EI=document.createElement('input');
			EI.id='EI-'+id;
			EI.classList.add("AssertionInput");
			EI.textContent='';
			
			EI.addEventListener('keyup', function onEvent(e) {
				if (event.key === "Enter") {
					appEv(EI.id.slice(3), EI.value, 'Write here the sources');
					
					id=EI.id.slice(3);
					id=id.slice(id.search("E-")+2);
					const graph=document.getElementById("graph");
					graph.innerHTML = "";
					showArg('0', graph);
					expandArg(id);
				}
			});
			
			document.getElementById('EL-'+parent).appendChild(EI);
		}
		
		function expandOption(id)
		{
			alert('expanding opt'+id);
		}
		
		function idList()
		{
			const argData = document.getElementById('argument-data').textContent;
            let rows = argData.split('\n');
            
            if(rows[0].length==0)
            {
				rows=rows.slice(1);
			}
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				rows[i]=rows[i].slice(0, ind).trim();
			}
			return rows;
		}
	
		function evList()
		{
			const argData = document.getElementById('evidence-data').textContent;
            let rows = argData.split('\n');
            
            if(rows[0].length==0)
            {
				rows=rows.slice(1);
			}
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				rows[i]=rows[i].slice(0, ind).trim();
			}
			return rows;
		}
		
		function isParentOf(parent, child)
		{
			ind=child.search("-");
			return (child.slice(ind+1)==parent && child!=parent);
		}
		
		function isEvidenceOf(parent, child)
		{
			ind=child.search("E-");
			return (child.slice(ind+2)==parent && child!=parent);
		}
		
		function primaryText(id)
		{
			const argData = document.getElementById('argument-data').textContent;
            let rows = argData.split('\n');
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				if(rows[i].slice(0, ind).trim()==id)
				{
					let end=rows[i].search("}{");
					return rows[i].slice(ind+1, end);
				}
			}
			return "ERRORE!!";
		}
		
		function secondaryText(id)
		{
			const argData = document.getElementById('argument-data').textContent;
            let rows = argData.split('\n');
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				if(rows[i].slice(0, ind).trim()==id)
				{
					ind=rows[i].search("}{")+2;
					let end=rows[i].slice(ind).search("}");
					return rows[i].slice(ind, ind+end);
				}
			}
			return "ERRORE!!";
		}
		
		function primaryTextEvidence(id)
		{
			const argData = document.getElementById('evidence-data').textContent;
            let rows = argData.split('\n');
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				if(rows[i].slice(0, ind).trim()==id)
				{
					let end=rows[i].search("}{");
					return rows[i].slice(ind+1, end);
				}
			}
			return "ERRORE!!";
		}
		
		function secondaryTextEvidence(id)
		{
			const argData = document.getElementById('evidence-data').textContent;
            let rows = argData.split('\n');
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				if(rows[i].slice(0, ind).trim()==id)
				{
					ind=rows[i].search("}{")+2;
					let end=rows[i].slice(ind).search("}");
					return rows[i].slice(ind, ind+end);
				}
			}
			return "ERRORE!!";
		}
		
		
		function appArg(id, prim, sec)
		{
			toAdd=id+'{'+prim+'}{'+sec+'}\n';
			document.getElementById('argument-data').append(toAdd);
		}
		
		function appEv(id, prim, sec)
		{
			toAdd=id+'{'+prim+'}{'+sec+'}\n';
			document.getElementById('evidence-data').append(toAdd);
		}
    
    </script>
</html>


