<html lang="en">
	<head>
		
		<link rel="stylesheet" href="style.css">
		
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Argument Tree</title>
	</head>

	<body>
		<div id="graph" align="center">
		</div>
	</body>
	
	<!-- Embed the code.txt content directly in the HTML -->
    <script id="code-data" type="text/plain">
0{Mozione}{Definizioni e contestualizzazione}
1-0{Assertion 1}{Reasoning 1}
2-0{Assertion 2}{Reasoning 2}
3-0{Assertion 3}{Reasoning 3}
1-1-0{SubAssertion}{Reasoning 4}
    </script>

	<script>
		
		 document.addEventListener('DOMContentLoaded', () => {
			parent=document.getElementById("graph");
			
			showArg('0', parent);
			expandArg('0');
        });
		
		function showArg(id, parent)
		{
			//Main div
			const main=document.createElement('div');
			main.id=id;
			main.classList.add("Arg");
			parent.appendChild(main);
			
			//trunk div
			const trunk=document.createElement('div');
			trunk.id='T-'+id;
			trunk.classList.add("Trunk");
			trunk.onclick=function() { expandArg(trunk.id.slice(2)) };
			main.appendChild(trunk);
			
			//Assertion
			const ass=document.createElement('p');
			ass.id='A-'+id;
			ass.classList.add("Assertion");
			ass.textContent=primaryText(id);
			trunk.appendChild(ass);
			
			//Secondary elements container
			const expanded=document.createElement('div');
			expanded.id='EXP-'+id;
			expanded.classList.add("Expanded");
			trunk.appendChild(expanded);
			
			//Reasoning
			const res=document.createElement('p');
			res.id='R-'+id;
			res.classList.add("Reasoning");
			res.textContent=secondaryText(id);
			expanded.appendChild(res);
			
			//Evidence List
			const el=document.createElement('ul');
			el.id='EL-'+id;
			el.classList.add("EvidenceList");
			expanded.appendChild(el);
			
			//Button Div
			const but=document.createElement('div');
			but.id='B-'+id;
			but.classList.add("BtnDiv");
			expanded.appendChild(but);
			
			
			//Add Button Evidence
			const addE=document.createElement('p');
			addE.id='AddE-'+id;
			addE.classList.add("AddBtnEvidence");
			addE.textContent="+";
			but.appendChild(addE);
			
			//More Options Button
			const opt=document.createElement('p');
			opt.id='OPT-'+id;
			opt.classList.add("OptBtn");
			opt.textContent=":";
			but.appendChild(opt);
			
			//SubArgument List
			const sal=document.createElement('ul');
			sal.id='SAL-'+id;
			sal.classList.add("SubArgList");
			main.appendChild(sal);
			
			IDs=idList();
			for(let i=0; i<IDs.length; i++)
			{
				if(isParentOf(id, IDs[i]))
				{
					showArg(IDs[i], sal);
				}
			}
			
			//Add Button Argument
			const addA=document.createElement('p');
			addA.id='AddA-'+id;
			addA.classList.add("AddBtnArg");
			addA.textContent="+";
			addA.onclick=function() { createArg(addA.id.slice(5)) };
			sal.appendChild(addA);
		}
		
		function expandArg(id)
		{
			IDs=idList();
			for(let i=0; i<IDs.length; i++)
			{
				val=""
				if(IDs[i]==id)
					val="block";
				else
					val="none";
				
				document.getElementById('EXP-'+IDs[i]).style.display=val;
			}
		}
		
		function createArg(parent)
		{
			let lastN=0;
			let found=1;
			IDs=idList();
			alert(IDs);
			while(found==1)
			{
				found=0;
				lastN++;
				for(i=0; i<IDs.length; i++)
				{
					if(lastN+'-'+parent==IDs[i])
						found=1;
				}
			}
			
			id=lastN+'-'+parent;
			
			const p=document.getElementById('AddA-'+parent);
			
			const AI=document.createElement('input');
			AI.id='AI-'+id;
			AI.classList.add("AssertionInput");
			AI.textContent='';
			
			AI.addEventListener('keyup', function onEvent(e) {
				if (event.key === "Enter") {
					appInp(AI.id.slice(3), AI.value, '');
					
					const graph=document.getElementById("graph");
					graph.innerHTML = "";
					showArg('0', graph);
					expandArg(AI.id.slice(3));
				}
			});
			
			p.replaceWith(AI);
		}
		
		function idList()
		{
			const codeData = document.getElementById('code-data').textContent;
            let rows = codeData.split('\n');
            
            if(rows[0].length==0)
            {
				rows=rows.slice(1);
			}
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				rows[i]=rows[i].slice(0, ind).trim();
			}
			return rows;
		}
		
		function isParentOf(parent, child)
		{
			ind=child.search("-");
			return (child.slice(ind+1)==parent && child!=parent);
		}
		
		function primaryText(id)
		{
			const codeData = document.getElementById('code-data').textContent;
            let rows = codeData.split('\n');
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				if(rows[i].slice(0, ind).trim()==id)
				{
					let end=rows[i].search("}{");
					return rows[i].slice(ind+1, end);
				}
			}
			return "ERRORE!!";
		}
		
		function secondaryText(id)
		{
			const codeData = document.getElementById('code-data').textContent;
            let rows = codeData.split('\n');
			
            for(let i=0; i<rows.length; i++)
            {	
				let ind=rows[i].search("{");
				if(rows[i].slice(0, ind).trim()==id)
				{
					ind=rows[i].search("}{")+2;
					let end=rows[i].slice(ind).search("}");
					return rows[i].slice(ind, ind+end);
				}
			}
			return "ERRORE!!";
		}
		
		function appInp(id, prim, sec)
		{
			
			toAdd=id+'{'+prim+'}{'+sec+'}\n';
			document.getElementById('code-data').append(toAdd);
		}
		
		
		/*
        
        function refocus(id){
			document.getElementById("graph").innerHTML = ""; 
			selId=id;
			parId=selId.slice(selId.search('-')+1);
			
			{
				const element = document.createElement('div');
				element.id = selId; // Assign a unique id
				element.classList.add("Argument");
				document.getElementById('graph').appendChild(element); // Append to the container
			}
			
			const MainDiv = document.getElementById(selId);
			
			
			{
				const element = document.createElement('ul');
				element.id = 'EvList-'+selId; // Assign a unique id
				element.classList.add("EvidenceList");
				MainDiv.appendChild(element); // Append to the container
			}
			{
				const element = document.createElement('ul');
				element.id = '-'+selId; // Assign a unique id
				element.classList.add("SubArgList");
				MainDiv.appendChild(element); // Append to the container
			}
			
			
			const SubArgList = document.getElementById('-'+selId);
			const EvidenceList = document.getElementById('EvList-'+selId);
			
            // Get the embedded text content from the script tag
            const codeData = document.getElementById('code-data').textContent;

            // Split the content into lines
            const rows = codeData.split('\n');

            rows.forEach((row, index) => {
				text=row.trim()
				if(text!='')
				{
					
					startAss=text.search("{")+1;
					startRes=text.search("}{")+2;
					
					if(text.slice(0,startAss-1)==parId && selId!=0)
					{
						const element = document.createElement('p');
						id='A-'+selId.slice(selId.search('-')+1);
						element.id = id; // Assign a unique id
						element.classList.add("ParentArgument");
						element.textContent = text.slice(startAss, startRes-2);
						element.onclick=function() { refocus(element.id.slice(2)); };
						document.getElementById('graph').insertBefore(element, document.getElementById('graph').firstChild);
						
					}
					
					if(text.slice(0,startAss-1)==selId)
					{
						const element = document.createElement('p');
						id='A-'+text.slice(0, startAss-1);
						element.id = id; // Assign a unique id
						element.classList.add("Reasoning");
						element.textContent = text.slice(startRes, text.length-1);
						MainDiv.insertBefore(element, MainDiv.firstChild);
					
						const element2 = document.createElement('p');
						id='A-'+text.slice(0, startAss-1);
						element2.id = id; // Assign a unique id
						element2.classList.add("Assertion");
						element2.textContent = text.slice(startAss, startRes-2);
						MainDiv.insertBefore(element2, MainDiv.firstChild);
					}
					
					if(text.slice(text.search('-'),startAss-1)=='-'+selId)
					{
						const element = document.createElement('li');
						id='A-'+text.slice(0, startAss-1);
						element.id = id;
						element.classList.add("SubArg");
						element.textContent = text.slice(startAss, startRes-2);
						element.onclick=function() { refocus(element.id.slice(2)); };
						SubArgList.appendChild(element); // Append to the container
					}
				}
            });
			
			{
				const element = document.createElement('li');
				element.textContent = '+';
				element.id='PA'+selId;
				element.onclick=function() { addArg(element.id.slice(2)); };
				element.classList.add("addBtn");
				SubArgList.appendChild(element); // Append to the container
			}
			
			{
				const element = document.createElement('li');
				element.textContent = '+';
				element.id='PE'+selId;
				element.onclick=function() { addEv(element.id.slice(2)); };
				element.classList.add("addBtn");
				EvidenceList.appendChild(element); // Append to the container
			}	
		}
		
		function addArg(id)
		{
            const codeData = document.getElementById('code-data').textContent;
            const rows = codeData.split('\n');
            occ=0;
            t=0;
            //*
			do{
				t+=1;
				occ=0;
				for(let i=0; i<rows.length; i++)
				{
					if(rows[i]!='')
					{						
						ind=rows[i].search('{');
						let extrId=rows[i].slice(0, ind);
						if(extrId==t+'-'+id)
						{
							occ=1;
						}
					}
				}
			}while(occ==1);
			
			newId=t+'-'+id;
			
			const MainDiv = document.getElementById(id);
			if(document.getElementById('i-'+newId)==null)
			{
				const element = document.createElement('input');
				element.id='i-'+newId;
				MainDiv.appendChild(element); // Append to the container
			}
			
			inputId = document.getElementById('i-'+newId);
			
			inputId.addEventListener('keyup', function onEvent(e) {
				if (event.key === "Enter") {
					newLine=newId+'{'+inputId.value+'}{}\n';
					document.getElementById('code-data').append(newLine);
					refocus(id);
				}
			});		
		}
		*/
    
    </script>
</html>


